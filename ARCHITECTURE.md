# System Architecture - AI Synthesis & Upload

## ðŸ—ï¸ AI Synthesis Search Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SEARCH RESULTS PAGE                        â”‚
â”‚                   (search-results.tsx)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ User enters query
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI SYNTHESIS SEARCH                            â”‚
â”‚              (aiSynthesisSearch() function)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
                    â–¼             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Knowledge Base   â”‚  â”‚  n8n Workflow   â”‚
        â”‚ Check KB Entry   â”‚  â”‚  (Fallback)     â”‚
        â”‚ (Fast ~50ms)     â”‚  â”‚  (Slower ~500ms)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ AI Synthesis Response             â”‚
        â”‚ - synthesis: string               â”‚
        â”‚ - source: "knowledge-base"|"n8n"  â”‚
        â”‚ - isHardcoded: boolean            â”‚
        â”‚ - providers: string[]             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DISPLAY IN SEARCH RESULTS                           â”‚
â”‚ â€¢ Show AI answer                                                 â”‚
â”‚ â€¢ Badge: "Hardcoded KB" or "n8n Workflow"                       â”‚
â”‚ â€¢ Related materials from institution                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Knowledge Base Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                AI_SYNTHESIS_KB Object                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     LAPLACE      â”‚  â”‚ DATA STRUCTURES  â”‚  â”‚TRANSFORMERS â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚â€¢ definition      â”‚  â”‚â€¢ definition      â”‚  â”‚â€¢ definition â”‚   â”‚
â”‚  â”‚â€¢ key points (6)  â”‚  â”‚â€¢ key points (5)  â”‚  â”‚â€¢ key points â”‚   â”‚
â”‚  â”‚â€¢ applications(6) â”‚  â”‚â€¢ applications(7) â”‚  â”‚â€¢ applicat.  â”‚   â”‚
â”‚  â”‚â€¢ examples (5)    â”‚  â”‚â€¢ examples (8)    â”‚  â”‚â€¢ examples   â”‚   â”‚
â”‚  â”‚â€¢ related (6)     â”‚  â”‚â€¢ related (7)     â”‚  â”‚â€¢ related    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Search Matching Logic

```
Input: "Laplace Transform applications"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Normalize: lowercase, trim     â”‚
â”‚    â†’ "laplace transform..."       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Check exact/partial matches   â”‚
â”‚    Against KB keys               â”‚
â”‚    â€¢ "laplace" âœ“ MATCH           â”‚
â”‚    â€¢ "transform" âœ— no key        â”‚
â”‚    â€¢ "applications" âœ— no key     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Return first matching entry   â”‚
â”‚    AI_SYNTHESIS_KB["laplace"]    â”‚
â”‚    âœ“ Found                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Format & Return               â”‚
â”‚    - source: "knowledge-base"    â”‚
â”‚    - isHardcoded: true           â”‚
â”‚    - synthesis: [formatted text] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“¤ Faculty Upload Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FACULTY MODE PAGE                            â”‚
â”‚                  (faculty-mode.tsx)                             â”‚
â”‚              "Upload PDF / Document Files" Tab                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    User fills form:
                    - Subject
                    - Title
                    - Description
                    - Tags
                    - File selection
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CLIENT-SIDE VALIDATION                               â”‚
â”‚           (faculty-mode.tsx)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Check:                                                           â”‚
â”‚ âœ“ File size (reject if > 100MB)                                 â”‚
â”‚ âœ“ Title present and < 255 chars                                 â”‚
â”‚ âœ“ Subject selected or typed                                     â”‚
â”‚                                                                  â”‚
â”‚ If invalid:                                                      â”‚
â”‚ â””â”€ Show error message â†’ Stop here                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Valid âœ“
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BUILD & SEND FORMDATA                              â”‚
â”‚                                                                  â”‚
â”‚ FormData {                                                       â”‚
â”‚   facultyEmail: "teacher@email.com"                             â”‚
â”‚   facultyName: "Prof. Smith"                                    â”‚
â”‚   subject: "Data Structures"                                    â”‚
â”‚   type: "PDF"                                                   â”‚
â”‚   title: "Chapter 5: Sorting"                                   â”‚
â”‚   description: "..."                                            â”‚
â”‚   tags: "sorting,algorithms"                                    â”‚
â”‚   file: [Binary File]                                           â”‚
â”‚ }                                                                â”‚
â”‚                                                                  â”‚
â”‚ POST /api/faculty-upload                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       SERVER-SIDE VALIDATION & PROCESSING                       â”‚
â”‚        (app/api/faculty-upload/route.ts)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ 1. PARSE FORMDATA                                               â”‚
â”‚    âœ“ Extract all fields                                         â”‚
â”‚                                                                  â”‚
â”‚ 2. VALIDATE FORM FIELDS                                         â”‚
â”‚    â”œâ”€ facultyEmail required?                                    â”‚
â”‚    â”œâ”€ subject required?                                         â”‚
â”‚    â”œâ”€ type required?                                            â”‚
â”‚    â”œâ”€ title required & < 255 chars?                             â”‚
â”‚    â””â”€ If invalid â†’ 400 error response                           â”‚
â”‚                                                                  â”‚
â”‚ 3. VALIDATE FILE (if present)                                   â”‚
â”‚    â”œâ”€ File size < 100MB?                                        â”‚
â”‚    â”œâ”€ File type in ALLOWED_FILE_TYPES?                          â”‚
â”‚    â”œâ”€ File name < 255 chars?                                    â”‚
â”‚    â””â”€ If invalid â†’ 413/415 error response                       â”‚
â”‚                                                                  â”‚
â”‚ 4. UPLOAD TO SUPABASE STORAGE                                   â”‚
â”‚    â”œâ”€ Generate safe file path                                   â”‚
â”‚    â”œâ”€ Upload blob to "faculty-materials" bucket                 â”‚
â”‚    â”œâ”€ Get public URL                                            â”‚
â”‚    â””â”€ If error â†’ 500/507 error response                         â”‚
â”‚                                                                  â”‚
â”‚ 5. INSERT RECORD TO DATABASE                                    â”‚
â”‚    â”œâ”€ Create faculty_materials record                           â”‚
â”‚    â”œâ”€ Link to file URL                                          â”‚
â”‚    â”œâ”€ Store metadata (tags, description, etc.)                  â”‚
â”‚    â””â”€ If error â†’ 500 error response                             â”‚
â”‚                                                                  â”‚
â”‚ 6. RETURN SUCCESS                                               â”‚
â”‚    â””â”€ Return 201 with material object                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
               SUCCESS          ERROR
                    â”‚             â”‚
                    â–¼             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 201 Response     â”‚ â”‚ 400/500 Response â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ {                â”‚ â”‚ {                â”‚
        â”‚  success: true   â”‚ â”‚  error: "..."    â”‚
        â”‚  material: {...} â”‚ â”‚  code: "..."     â”‚
        â”‚  message: "..."  â”‚ â”‚  details: "..."  â”‚
        â”‚ }                â”‚ â”‚ }                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                  â”‚
                   â–¼                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Show Success UI  â”‚ â”‚ Show Error UI    â”‚
        â”‚ - Green badge    â”‚ â”‚ - Red badge      â”‚
        â”‚ - Message        â”‚ â”‚ - User-friendly  â”‚
        â”‚ - Clear form     â”‚ â”‚   error text     â”‚
        â”‚ - File indexed   â”‚ â”‚ - Suggestions    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Validation Error Codes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ERROR CODE MAPPING                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ CLIENT SIDE (faculty-mode.tsx):                             â”‚
â”‚ â”œâ”€ FILE_TOO_LARGE â†’ "Reduce file size"                     â”‚
â”‚ â”œâ”€ TITLE_EMPTY â†’ "Please provide a title"                  â”‚
â”‚ â”œâ”€ TITLE_TOO_LONG â†’ "Title max 255 chars"                  â”‚
â”‚ â”œâ”€ SUBJECT_EMPTY â†’ "Select or type subject"                â”‚
â”‚ â””â”€ Prevents submission with error shown                     â”‚
â”‚                                                              â”‚
â”‚ SERVER SIDE (route.ts):                                     â”‚
â”‚ â”œâ”€ 400 (Bad Request)                                        â”‚
â”‚ â”‚  â”œâ”€ MISSING_FACULTY_EMAIL                                â”‚
â”‚ â”‚  â”œâ”€ MISSING_SUBJECT                                      â”‚
â”‚ â”‚  â”œâ”€ MISSING_TYPE                                         â”‚
â”‚ â”‚  â”œâ”€ MISSING_TITLE                                        â”‚
â”‚ â”‚  â”œâ”€ TITLE_TOO_LONG                                       â”‚
â”‚ â”‚  â””â”€ FILENAME_TOO_LONG                                    â”‚
â”‚ â”‚                                                            â”‚
â”‚ â”œâ”€ 413 (Payload Too Large)                                  â”‚
â”‚ â”‚  â””â”€ FILE_TOO_LARGE                                       â”‚
â”‚ â”‚                                                            â”‚
â”‚ â”œâ”€ 415 (Unsupported Media Type)                            â”‚
â”‚ â”‚  â””â”€ INVALID_FILE_TYPE                                    â”‚
â”‚ â”‚     (shows supported formats)                             â”‚
â”‚ â”‚                                                            â”‚
â”‚ â”œâ”€ 500 (Server Error)                                       â”‚
â”‚ â”‚  â”œâ”€ STORAGE_ERROR                                         â”‚
â”‚ â”‚  â”‚  â”œâ”€ Quota exceeded                                     â”‚
â”‚ â”‚  â”‚  â”œâ”€ Permission denied                                  â”‚
â”‚ â”‚  â”‚  â””â”€ File duplicate                                     â”‚
â”‚ â”‚  â”‚                                                         â”‚
â”‚ â”‚  â””â”€ DATABASE_ERROR                                        â”‚
â”‚ â”‚     (file saved but DB insert failed)                     â”‚
â”‚ â”‚                                                            â”‚
â”‚ â””â”€ INTERNAL_ERROR (catch-all for exceptions)                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ—‚ï¸ File Organization

```
Project Root
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ ai.service.ts              [MODIFIED] AI synthesis search
â”‚       â”œâ”€â”€ ai-synthesis-kb.ts          [NEW] Knowledge base
â”‚       â”œâ”€â”€ academic.service.ts
â”‚       â”œâ”€â”€ download.ts
â”‚       â””â”€â”€ types.ts
â”‚
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ faculty-upload/
â”‚       â”‚   â””â”€â”€ route.ts                [MODIFIED] Enhanced upload
â”‚       â””â”€â”€ [other endpoints]
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ edunexus/
â”‚       â”œâ”€â”€ search-results.tsx          [MODIFIED] Uses synthesis search
â”‚       â”œâ”€â”€ faculty-mode.tsx            [MODIFIED] Better error handling
â”‚       â”œâ”€â”€ hero-search.tsx
â”‚       â”œâ”€â”€ admin-dashboard.tsx
â”‚       â””â”€â”€ [other components]
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md       [NEW] Technical overview
    â”œâ”€â”€ TESTING_GUIDE.md                [NEW] How to test
    â”œâ”€â”€ QUICK_REFERENCE.md              [NEW] Quick tasks
    â”œâ”€â”€ CHANGES.md                      [NEW] What changed
    â””â”€â”€ ARCHITECTURE.md                 [NEW] This file
```

---

## ðŸ”„ Data Flow Diagram

```
SEARCH FLOW:
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚User â”‚â”€â”€â”€â”€â–¶â”‚Search Barâ”‚â”€â”€â”€â”€â–¶â”‚Synthesis â”‚â”€â”€â”€â”€â–¶â”‚KB or n8n     â”‚
â”‚     â”‚     â”‚Component â”‚     â”‚Function  â”‚     â”‚Provider      â”‚
â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚Format Response â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚Display Result  â”‚
                                              â”‚with Badge      â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UPLOAD FLOW:
â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Form â”‚â”€â”€â–¶â”‚Validate  â”‚â”€â”€â–¶â”‚Upload File  â”‚â”€â”€â–¶â”‚Save to  â”‚
â”‚Data â”‚   â”‚Client    â”‚   â”‚to Storage   â”‚   â”‚Database â”‚
â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚          â”‚               â”‚                 â”‚
   â”‚          â”‚               â”‚                 â”‚
   â””â”€ Invalid â””â”€ Error â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€ Error â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Shown to User
```

---

## ðŸ“Š Dependency Graph

```
search-results.tsx
    â”œâ”€â”€ Uses: aiSynthesisSearch (new)
    â”œâ”€â”€ Uses: aiExplain (existing)
    â”œâ”€â”€ Uses: n8nChat (existing)
    â””â”€â”€ Depends on: ai.service.ts

ai.service.ts
    â””â”€â”€ Uses: ai-synthesis-kb.ts (new)
        â”œâ”€â”€ getKnowledgeEntry()
        â”œâ”€â”€ formatKnowledgeEntryForAI()
        â””â”€â”€ matchesKnowledgeBase()

faculty-mode.tsx
    â””â”€â”€ Posts to: /api/faculty-upload

faculty-upload/route.ts
    â”œâ”€â”€ Validates: Form & File
    â”œâ”€â”€ Uploads to: Supabase Storage
    â””â”€â”€ Saves to: faculty_materials table

Components flow to:
    â””â”€â”€ Supabase (Storage + Database)
        â”œâ”€â”€ Bucket: faculty-materials
        â””â”€â”€ Table: faculty_materials
```

---

## ðŸš€ Deployment Considerations

### No Database Changes
âœ… Existing `faculty_materials` table used as-is
âœ… New fields not needed

### No Environment Variable Changes
âœ… Uses existing Supabase keys
âœ… Uses existing n8n webhook URL

### Browser Compatibility
âœ… Works on all modern browsers
âœ… File upload drag-drop supported
âœ… FormData API fully supported

### Performance
âœ… KB searches: 50-100ms (10x faster than n8n)
âœ… Upload: Same as before, better UX
âœ… No additional API calls for validation

### Security
âœ… File validation on both client & server
âœ… File type whitelist enforced
âœ… Error messages don't leak sensitive data
âœ… File names sanitized

---

## ðŸ”§ Extension Points

### Add New KB Topic:
```
Edit: /lib/api/ai-synthesis-kb.ts
Add entry to: AI_SYNTHESIS_KB object
```

### Add New File Type:
```
Edit 1: /app/api/faculty-upload/route.ts
        â†’ ALLOWED_FILE_TYPES array

Edit 2: /components/edunexus/faculty-mode.tsx
        â†’ ACCEPTED_TYPES array
```

### Change Upload Size:
```
Edit: /app/api/faculty-upload/route.ts
      â†’ MAX_FILE_SIZE constant (line 5)
```

### Add New Synthesis Provider:
```
Edit: /lib/api/ai.service.ts
      â†’ aiSynthesisSearch() function
      â†’ Add new provider in priority chain
```

---

**Last Updated**: February 2024
**Status**: âœ… Implementation Complete
